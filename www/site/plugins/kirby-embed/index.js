(function () {function c(t){var o=new RegExp(/^(?:http(s)?:\/\/)?[\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:\/?#[\]@!\$&'\(\)\*\+,;=.]+$/g);return!t||t.match(o)}function d(t,o){var r={youtube:/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/,vimeo:/vimeo\.com\/([0-9]+)/,flickr:/^.*(flickr\.com)\/(.*)/,soundcloud:/^.*(soundcloud\.com|snd\.sc)\/(.*)/,twitter:/^.*(twitter\.com)\/(.*)/,instagram:/^.*(instagram\.com)\/(.*)/};return-1!=Object.keys(r).indexOf(o)&&t.match(r[o])}var a={extends:"k-url-field",data:function(){return{media:Object,loading:!1}},props:{provider:String},created:function(){this.value&&this.value.media&&this.hasLength(this.value.media)&&(this.media=this.value.media)},computed:{hasMedia:function(){return this.hasLength(this.media)&&this.media.code},syncFailed:function(){return""!=this.inputValue&&this.isValidUrl(this.inputValue)&&!this.hasMedia},inputValue:function(){return this.value&&this.value.input?this.value.input:""}},methods:{setMedia:function(t){this.media=t,this.stopLoading()},hasLength:function(t){return Object.keys(t).length},startLoading:function(){this.loading=!0},stopLoading:function(){this.loading=!1},isValidUrl:function(t){return!!c(t)&&!(this.provider&&!d(t,this.provider))}}};if(typeof a==="function"){a=a.options}Object.assign(a,function(){var render=function(){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c("k-field",_vm._b({staticClass:"k-embed-field k-url-field k-field",attrs:{"input":_vm._uid}},"k-field",_vm.$props,false),[_vm.hasMedia?_c("div",{staticClass:"preview"},[_c("div",{staticClass:"preview-content",domProps:{"innerHTML":_vm._s(_vm.media.code)}}),_vm._v(" "),_c("div",{staticClass:"preview-background"})]):_vm._e(),_vm._v(" "),_c("k-input",_vm._g(_vm._b({ref:"input",attrs:{"id":_vm._uid,"value":_vm.inputValue,"media":_vm.media,"theme":"field"},on:{"setMedia":_vm.setMedia,"startLoading":_vm.startLoading}},"k-input",_vm.$props,false),_vm.$listeners),[_c("div",{staticClass:"k-embed-infos",attrs:{"slot":"icon"},slot:"icon"},[_c("div",{staticClass:"k-embed-status"},[_vm.loading?_c("span",{staticClass:"k-embed-status-loading"},[_c("span",{staticClass:"loader"})]):_vm.hasMedia?_c("span",{staticClass:"k-embed-status-synced"},[_vm._v(_vm._s(_vm.$t("embed.synced"))+" "),_c("span",{staticClass:"checkmark"})]):_vm.syncFailed?_c("span",{staticClass:"k-embed-status-failed"},[_vm._v(_vm._s(_vm.$t("embed.failed"))+" "),_c("span",{staticClass:"cross"})]):_vm._e()]),_vm._v(" "),_vm.link?_c("k-button",{staticClass:"k-input-icon-button",attrs:{"icon":_vm.icon,"link":_vm.inputValue,"tooltip":_vm.$t("open"),"tabindex":"-1","target":"_blank","rel":"noopener"}}):_vm._e()],1)])],1)};var staticRenderFns=[];return{render:render,staticRenderFns:staticRenderFns,_compiled:true,_scopeId:null,functional:undefined}}());var b={extends:"k-url-input",props:{provider:String,media:Object},mounted:function(){this.loadEmbedScripts()},methods:{onInput:function(t){var e=this;if(!this.isValidUrl(t))return this.media={},this.emitInput(t),!1;this.$emit("startLoading"),this.$api.get("kirby-embed/get-data",{url:t}).then(function(i){"success"==i.status&&i.data?e.media=i.data:e.media={},e.emitInput(t)}).catch(function(i){e.media={},e.emitInput(t)})},emitInput:function(t){this.$emit("input",{input:t,media:this.media}),this.$emit("setMedia",this.media),this.loadEmbedScripts()},loadEmbedScripts:function(){if(window.twttr)window.twttr.widgets.load();else if(this.media&&Object.keys(this.media).length&&"twitter"==this.media.providerName.toLowerCase()){var t=document.createElement("script");t.src="https://platform.twitter.com/widgets.js",document.body.appendChild(t)}if(window.instgrm)window.instgrm.Embeds.process();else if(this.media&&Object.keys(this.media).length&&"instagram"==this.media.providerName.toLowerCase()){var e=document.createElement("script");e.src="https://www.instagram.com/embed.js",document.body.appendChild(e)}},isValidUrl:function(t){return!!c(t)&&!(this.provider&&!d(t,this.provider))}}};if(typeof b==="function"){b=b.options}panel.plugin("sylvainjule/embed",{fields:{embed:a},components:{"k-embed-input":b}});})();